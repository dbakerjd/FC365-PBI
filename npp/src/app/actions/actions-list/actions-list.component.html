<app-npp-header [isHome]="false"></app-npp-header>
<div class="opportunity-info-wrapper" *ngIf="opportunity">
    <div class="opportunity-name">
        <h2>{{opportunity.title}}</h2>
        <div>
            <div class="opportunity-active" *ngIf="opportunity.opportunityStatus == 'Active'"></div>
            <div class="opportunity-archived" *ngIf="opportunity.opportunityStatus == 'Archived'"></div>
            {{opportunity.opportunityStatus}}
            &nbsp;Â·&nbsp;
            <label>{{opportunity.opportunityType}}</label>
        </div>
    </div>
    <div class="opportunity-dates">
        <p><label>Project start: </label> {{opportunity.projectStart | date : 'MMM y'}}</p>
        <p><label>Project end: </label> {{opportunity.projectEnd | date : 'MMM y'}}</p>
    </div>
    <div class="opportunity-molecule">
        <p><label>Molecule Name: </label> {{opportunity.moleculeName}}</p>
        <p><label>Indication: </label> {{opportunity.indicationName}}</p> 
    </div>
    <div class="opportunity-owner">
        <div class="opportunity-owner-pic">
            <div class="opportunity-owner-pic-background"></div>
            <img [src]="opportunity.opportunityOwner.profilePic"/>
        </div>
        <div class="opportunity-owner-info">
            <div class="opportunity-owner-info-title"><label>Opportunity Owner</label></div>
            <div class="opportunity-owner-info-name">{{opportunity.opportunityOwner.name}}</div>
        </div>
    </div>
</div>
<div class="gates-and-actions-wrapper">
    <div class="gates-wrapper">
        <div class="gates-item-wrapper" *ngFor="let gate of gates">
            <div class="gates-item"  [ngClass]="{'selected-gate': currentGate && currentGate.id === gate.id, 'folders-visible': currentSection == 'documents'}" (click)="setGate(gate.id)">
                <span>{{gate.name}}</span>
                <svg *ngIf=" currentSection == 'documents' ">
                    <use xlink:href="assets/symbol-defs.svg#icon-chevron"></use>
                </svg>
            </div>
            <div class="folders-wrapper" *ngIf="currentSection == 'documents' && currentGate && currentGate.id === gate.id">
                <div class="folders-item" *ngFor="let folder of gate.folders" [ngClass]="{'selected-folder': currentFolder === folder.id}" (click)="setFolder(folder.id)">
                    <svg>
                        <use xlink:href="assets/symbol-defs.svg#icon-folder"></use>
                    </svg>
                    <span>{{folder.name}}</span>
                    <img src="assets/user.svg"/>
                </div>
            </div>
        </div>
    </div>
    <div class="actions-wrapper">
        <div class="gate-info-wrapper">
            <div class="gate-info-review">
                <label>{{currentGate?.name}} Review date: </label>
                {{currentGate?.reviewedAt | date : 'Y-M-d'}}
            </div>
            <div class="gate-info-progress">
                <label>{{currentGate?.name}} Progress: </label>
                &nbsp;{{currentGateProgress}}%
                <app-progress-bar [progress]="currentGateProgress"></app-progress-bar>
            </div>
            <div class="gate-info-icons">
                <div class="gate-info-icons-upload" title="Upload file" (click)="openUploadDialog()"></div>
                <div class="gate-info-icons-actions" title="Actions list" (click)="setSection('actions')"></div>
                <div class="gate-info-icons-documents" title="Documents" (click)="showFolders()"></div>
                <div class="gate-info-icons-models" title="Models" (click)="showModels()"></div>
                <div class="gate-info-icons-refresh-bi" title="Refresh Power BI"></div>
                <div class="gate-info-icons-stage-settings" title="Stage Settings"></div>
            </div>
        </div>
        <div [ngSwitch]="currentSection">
            <!-- DOCUMENTS LIST -->
            <div *ngSwitchCase="'documents'">
                <div class="documents-files">
                    <div class="documents-files-item" *ngFor="let file of currentFiles">
                        <div class="documents-files-item-name">
                            <p><label>name: </label>{{file.name}}</p>
                        </div>
                        <div class="documents-files-item-uploaded">
                            <p><label>uploaded at </label>{{file.updatedAt | date : 'Y-M-d'}} <label> by </label>{{file.user.name}}</p>
                        </div>
                        <div class="documents-files-item-comments">
                            <p><label>comments: </label>{{file.description}}</p>
                        </div>
                        <div class="documents-files-item-icons">
                            <div class="documents-files-item-icons-file" title="Open file"></div>
                            <div class="documents-files-item-icons-download" title="Download file"></div>
                            <div class="documents-files-item-icons-share" title="Share file"></div>
                            <div class="documents-files-item-icons-remove" title="Delete file"></div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- ACTIONS LIST -->
            <div *ngSwitchDefault>
                <div class="action-item" *ngFor="let action of currentActions">
                    <div class="action-item-name"><span>{{action.actionName}}</span></div>
                    <div class="action-item-completed" *ngIf="action.completed">
                        <label>Completed: </label>
                        {{action.timestamp | date : 'Y-M-d'}}
                        <label> at </label>
                        {{action.timestamp | date : 'HH:mm'}}
                        <label> by </label>
                        {{action.targetUser?.name}}
                    </div>
                    <div class="action-item-completed" *ngIf="!action.completed">Not completed yet</div>
                    <div class="action-item-due">
                        <label>Due by </label>
                        <ngx-datepicker [(ngModel)]="action.dueDate" [options]="dateOptions"></ngx-datepicker>
                    </div>
                    <div class="action-item-complete" (click)="toggleStatus(action)" [ngClass]="{ 'action-completed': action.status == 'completed', 'action-late': action.status == 'late', 'action-pending': action.status == 'pending'}">
                        <span>{{action.status}}</span>
                        <div class="action-item-status-icon"></div>
                    </div>
                </div>        
            </div>
        </div>        
    </div>
</div>
